# FileScanApp - 文件闪搜大师

FileScanApp 是一款基于 PyQt6 的桌面应用程序，旨在提供快速、高效的本地文件和文件夹索引与搜索功能。它通过建立文件元数据（如路径、大小、创建/修改时间等）的本地数据库索引，实现了远超操作系统自带搜索的即时搜索体验。此外，应用还具备可配置的自动清理功能，帮助用户管理指定目录下的旧文件或控制文件夹大小。

## 主要功能

*   **快速文件索引**：扫描用户指定的文件夹路径，并将文件和文件夹的元数据存入本地 SQLite 数据库。
*   **即时搜索**：
    *   支持按文件名、路径关键词进行模糊搜索、前缀搜索、后缀搜索。
    *   支持按日期（年、年月、年月日）进行精确范围搜索。
*   **结果展示**：
    *   以表格形式清晰展示搜索结果，包含文件名、路径、类型、大小、创建/修改/访问时间等。
    *   支持按任意列排序。
    *   可自定义显示的列。
*   **文件操作**：
    *   双击结果项可直接打开文件或文件夹。
    *   右键菜单提供“打开”、“打开所在文件夹”、“复制完整路径”、“删除”等操作。
*   **自动清理策略** (可按路径独立配置)：
    *   **基于时间的清理**：自动删除指定天数之前创建的旧文件。
    *   **基于大小的清理**：当指定文件夹的总大小超过用户设定的阈值时，自动删除最旧的文件，直至文件夹大小降低到阈值的80%。
*   **个性化设置**：
    *   管理需要索引的文件夹路径。
    *   为不同扫描路径设置不同的高亮颜色，方便在结果中区分。
    *   调整搜索延迟、最大显示结果数等性能参数。
    *   配置清理策略的参数（清理天数、大小警告阈值）。
    *   选择浅色或深色主题。
*   **实时反馈**：
    *   状态栏显示索引进度、搜索结果数量、清理进度等。
    *   文件夹大小超限时弹出警告。
*   **日志系统**：记录详细的运行日志，方便问题排查和监控。

## 技术栈

*   **Python 3.x**
*   **PyQt6**：用于构建图形用户界面。
*   **SQLite3**：用于本地数据存储和索引。
*   **多线程**：索引、搜索和清理任务在后台线程中执行，避免UI卡顿。

## 如何运行

1.  **环境准备**：
    *   确保已安装 Python 3 (推荐 3.7+)。
    *   安装必要的 PyQt6 库：
        ```bash
        pip install PyQt6
        ```
2.  **获取代码**：
    *   将 `FileScanApp.py` (或者您命名的主程序文件，例如 `1.0.py`) 文件放置在您的项目目录中。
3.  **运行程序**：
    *   在命令行中，导航到该文件所在的目录，然后执行：
        ```bash
        python FileScanApp.py
        ```
    *   或者通过您的 Python IDE直接运行该文件。

## 首次使用

1.  程序启动后，数据库 (`FileScan.db`) 和配置文件 (`config.json`) 会在程序同目录下自动创建（如果不存在）。
2.  点击主界面右上角的 **“设置”** 按钮。
3.  在“扫描路径管理”部分，点击 **“添加路径”** 选择您希望索引的文件夹。
4.  为添加的路径选择一个高亮颜色（可选），并勾选“启用自动清理”（如果需要）。
5.  根据需要调整“性能优化”和“自动清理策略”中的参数。
6.  点击 **“保存设置”**。
7.  程序会自动开始对新添加的路径进行首次索引。您可以在状态栏看到索引进度。
8.  索引完成后，即可在主界面的搜索框中输入关键词进行搜索。

## 文件结构

*   `FileScanApp.py` (或类似的主程序文件): 应用程序的全部Python代码。
*   `FileScan.db`: SQLite 数据库文件，存储文件索引。
*   `config.json`: JSON 格式的配置文件，存储用户设置（如扫描路径、主题、清理参数等）。
*   `logs/`: 文件夹，存放程序运行日志文件 (按日期时间命名)。

## 功能模块说明

### 1. DBManager (数据库管理)
   负责数据库的连接、表的创建与维护、索引的创建、文件元数据的批量插入与删除，以及执行文件搜索的SQL查询。

### 2. ConfigManager (配置管理)
   负责加载和保存 `config.json` 文件中的用户配置。提供获取和设置配置项的接口。

### 3. IndexerThread (后台索引线程)
   在后台执行文件和文件夹的扫描任务。
   - 遍历指定路径，收集文件元数据。
   - 对比数据库中现有数据，仅处理新增或修改过的项。
   - 批量将数据写入数据库。
   - 清理数据库中已不存在于文件系统或不再扫描范围内的条目。
   - 通过信号向主界面报告索引进度和完成状态。

### 4. SearchWorker (后台搜索线程)
   在后台执行搜索查询。
   - 解析用户输入，支持文本和日期格式。
   - 调用 `DBManager` 执行SQL查询。
   - 通过信号将搜索结果返回给主界面。

### 5. CleanupThread (后台清理线程)
   周期性地在后台执行清理任务。
   - **基于时间的清理**：检查配置了清理的路径，删除早于设定天数的文件。
   - **基于大小的清理**：检查配置了清理的路径，如果其总大小超过设定的阈值，则开始删除最旧的文件，直到文件夹大小降至阈值的80%。
   - 通过信号向主界面报告清理进度、完成状态、错误以及文件夹大小警告。

### 6. SettingsWindow (设置窗口)
   提供一个对话框界面，允许用户：
   - 添加、移除和配置扫描路径（包括颜色和是否启用清理）。
   - 设置搜索延迟、最大显示结果数。
   - 配置全局的清理天数和文件夹大小警告阈值。
   - 选择界面主题（浅色/深色）。
   - 选择在结果列表中显示的列。

### 7. FileScanWindow (主应用程序窗口)
   应用程序的主界面。
   - 初始化和管理所有后台线程和管理器。
   - 提供搜索输入框和操作按钮（重新索引、设置）。
   - 使用 `QTableWidget` 显示搜索结果。
   - 实现结果排序、双击打开、右键菜单等交互。
   - 通过状态栏和进度条向用户显示程序状态。
   - 应用用户选择的主题和样式。
   - 处理来自后台线程的信号，更新UI。

## 注意事项与未来展望

*   **性能**：对于包含数百万文件的巨大目录，首次索引可能需要较长时间。后续增量索引会快得多。
*   **跨平台**：主要在Windows上测试，Linux和macOS上的路径处理、文件系统交互可能需要进一步测试和调整。QSS样式在不同平台也可能有细微差异。
*   **错误处理**：已包含基本的错误处理和日志记录，但可以进一步增强，例如更细致地处理文件访问权限问题。
*   **自定义图标**：当前主要使用Qt标准图标，未来可以集成自定义图标集以提升视觉独特性。
*   **高级搜索**：可以考虑加入更复杂的搜索逻辑，如布尔操作、正则表达式搜索、按文件大小范围搜索等。
*   **预览功能**：为图片或文本文件添加预览窗格。

## 贡献

欢迎对本项目提出改进建议或贡献代码。

---
